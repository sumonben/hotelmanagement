{% extends 'base.html' %}
{% load static %}

{% block title %}Cancel Booking - {{ booking.booking_id }}{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h3 class="mb-0"><i class="fas fa-times-circle"></i> Cancel Booking</h3>
                </div>
                <div class="card-body">
                    <!-- Booking Details -->
                    <div class="alert alert-info">
                        <h5>Booking Details</h5>
                        <ul class="list-unstyled">
                            <li><strong>Booking ID:</strong> {{ booking.booking_id }}</li>
                            <li><strong>Hotel:</strong> {{ booking.hotel.name }}</li>
                            <li><strong>Room:</strong> {{ booking.room.room_number }} - {{ booking.room.room_type.name }}</li>
                            <li><strong>Check-in:</strong> {{ booking.check_in_date }}</li>
                            <li><strong>Check-out:</strong> {{ booking.check_out_date }}</li>
                            <li><strong>Total Price:</strong> ${{ booking.total_price }}</li>
                        </ul>
                    </div>

                    <!-- Cancellation Policy -->
                    {% if booking.cancellation_policy %}
                    <div class="alert alert-warning">
                        <h5><i class="fas fa-exclamation-triangle"></i> Cancellation Policy</h5>
                        <p><strong>Policy:</strong> {{ booking.cancellation_policy.name }}</p>
                        <p><strong>Refund Percentage:</strong> {{ booking.cancellation_policy.refund_percentage }}%</p>
                        <p><strong>Deadline:</strong> {{ booking.cancellation_policy.days_before_checkin }} days before check-in</p>
                        {% if booking.cancellation_policy.description %}
                        <p><strong>Details:</strong> {{ booking.cancellation_policy.description }}</p>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <p>No cancellation policy information available.</p>
                    </div>
                    {% endif %}

                    <!-- Cancellation Form -->
                    <form method="post" novalidate>
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="{{ form.reason.id_for_label }}" class="form-label">
                                <strong>Reason for Cancellation</strong>
                            </label>
                            {{ form.reason }}
                            {% if form.reason.errors %}
                                <div class="invalid-feedback d-block">{{ form.reason.errors }}</div>
                            {% endif %}
                        </div>

                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {{ form.non_field_errors }}
                        </div>
                        {% endif %}

                        <!-- Warning Alert -->
                        <div class="alert alert-danger" role="alert">
                            <h5><i class="fas fa-exclamation"></i> Important</h5>
                            <p>Once you cancel this booking, you cannot undo this action. Please make sure you want to proceed.</p>
                            <ul class="mb-0">
                                <li>Your booking will be marked as cancelled</li>
                                <li>A refund will be processed according to the cancellation policy</li>
                                <li>You will receive a confirmation email</li>
                            </ul>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash-alt"></i> Confirm Cancellation
                            </button>
                            <a href="{% url 'booking:booking_detail' booking.id %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Go Back
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="card mt-4 shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Need Help?</h5>
                </div>
                <div class="card-body">
                    <p>If you have questions about cancellation or need assistance, please contact us:</p>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-phone"></i> <strong>Phone:</strong> {{ booking.hotel.phone }}</li>
                        <li><i class="fas fa-envelope"></i> <strong>Email:</strong> {{ booking.hotel.email }}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border: none;
        border-radius: 8px;
    }

    .card-header {
        border-radius: 8px 8px 0 0;
        padding: 1.25rem;
    }

    .alert {
        border-radius: 6px;
    }

    .btn {
        border-radius: 6px;
        padding: 0.5rem 1.5rem;
    }

    textarea.form-control {
        resize: vertical;
        min-height: 120px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .gap-2 {
        gap: 0.5rem;
    }
</style>
{% endblock %}
